{% extends "base.html" %}
{% block content %}
<div class="search-box">
  <form method="get" action="{{ url_for('catalog.catalog') }}">
    <input type="text" name="q" placeholder="Търсене по име или цвят"
           value="{{ request.args.get('q', '') }}">
    <button type="submit">Търсене</button>
  </form>
</div>


<div class="catalog-layout">

  <aside class="filters">
    <h3>Филтрирай</h3>
    <form method="get" action="{{ url_for('catalog.catalog') }}">
      <input type="number" step="0.01" name="min_price" placeholder="Мин. цена"
             value="{{ request.args.get('min_price', '') }}">
      <input type="number" step="0.01" name="max_price" placeholder="Макс. цена"
             value="{{ request.args.get('max_price', '') }}">
      <input type="number" name="size" placeholder="Размер"
             value="{{ request.args.get('size', '') }}">

      <label>
        <input type="checkbox" name="in_stock" value="1"
               {% if request.args.get('in_stock') %}checked{% endif %}>
        В наличност
      </label>

      <select name="category">
        <option value="">--Категория--</option>
        <option value="мъжки" {% if request.args.get('category') == 'мъжки' %}selected{% endif %}>Мъжки</option>
        <option value="женски" {% if request.args.get('category') == 'женски' %}selected{% endif %}>Женски</option>
        <option value="детски" {% if request.args.get('category') == 'детски' %}selected{% endif %}>Детски</option>
      </select>

      <select name="subcategory">
        <option value="">--Подкатегория--</option>
        <option value="спортни" {% if request.args.get('subcategory') == 'спортни' %}selected{% endif %}>Спортни</option>
        <option value="официални" {% if request.args.get('subcategory') == 'официални' %}selected{% endif %}>Официални</option>
        <option value="ежедневни" {% if request.args.get('subcategory') == 'ежедневни' %}selected{% endif %}>Ежедневни</option>
      </select>

      <select name="sort_by">
        <option value="price" {% if sort_by == 'price' %}selected{% endif %}>Цена</option>
        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Име</option>
        <option value="stock" {% if sort_by == 'stock' %}selected{% endif %}>Наличност</option>
      </select>

      <select name="order">
        <option value="asc" {% if order == 'asc' %}selected{% endif %}>Възходящо</option>
        <option value="desc" {% if order == 'desc' %}selected{% endif %}>Низходящо</option>
      </select>

      <button type="submit">Филтрирай</button>
    </form>
  </aside>

  <section class="products">
    {% if products %}
      <div class="product-grid">
        {% for p in products %}
          <div class="product-card">
          {% if p.image_url %}
    <img src="{{ p.image_url }}" alt="{{ p.name }}"
         style="width:100%; height:200px; object-fit:cover; border-radius:8px; margin-bottom:10px;">
  {% endif %}
            <h4>{{ p.name }}</h4>
            <p><b>Цвят:</b> {{ p.color }}</p>
            <p><b>Цена:</b> {{ p.price }} лв.</p>
            <p><b>Описание:</b> {{ p.description }}</p>
            <p><b>Размери:</b> {{ p.sizes|join(", ") }}</p>
            <p><b>Наличност:</b> {{ p.stock }}</p>
            <p><b>Категория:</b> {{ p.category }} / {{ p.subcategory }}</p>

            <form action="{{ url_for('cart.add_to_cart', product_id=p.id) }}" method="post">
              <label>Брой:</label>
              <input type="number" name="quantity" value="1" min="1">
              <button type="submit">Добави в кошницата</button>
            </form>

            {% if is_admin %}
              <div class="admin-links">
                <a href="{{ url_for('catalog.edit_product', product_id=p.id) }}">Редактирай</a> |
                <a href="{{ url_for('catalog.delete_product', product_id=p.id) }}">Изтрий</a>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p><b>Няма намерени продукти по зададените критерии.</b></p>
    {% endif %}
  </section>
</div>
    {% if is_admin and show_add_form %}
<div class="add-product-wrapper">
  <div class="add-product-form">
    <h3>Добавяне на нов продукт</h3>
    <form method="post" action="{{ url_for('catalog.catalog') }}">
      <div class="form-group">
        <label>Име:</label>
        <input type="text" name="name" required>
      </div>

      <div class="form-group">
        <label>Описание:</label>
        <textarea name="description" required></textarea>
      </div>

      <div class="form-group">
        <label>Цвят:</label>
        <input type="text" name="color" required>
      </div>

      <div class="form-group">
        <label>Размери (38,39,40):</label>
        <input type="text" name="sizes" placeholder="38,39,40" required>
      </div>

      <div class="form-group">
        <label>Цена:</label>
        <input type="number" step="0.01" name="price" required>
      </div>

      <div class="form-group">
        <label>Наличност:</label>
        <input type="number" name="stock" required>
      </div>

      <div class="form-group">
        <label>Категория:</label>
        <select name="category" required>
          <option value="мъжки">Мъжки</option>
          <option value="женски">Женски</option>
          <option value="детски">Детски</option>
        </select>
      </div>

      <div class="form-group">
        <label>Подкатегория:</label>
        <select name="subcategory" required>
          <option value="спортни">Спортни</option>
          <option value="официални">Официални</option>
          <option value="ежедневни">Ежедневни</option>
        </select>
      </div>

      <button type="submit" class="btn-submit">Добави продукт</button>
    </form>
  </div>
</div>
{% endif %}

{% endblock %}
