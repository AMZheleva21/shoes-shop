{% extends "base.html" %}
{% block content %}
<h2>–ö–∞—Ç–∞–ª–æ–≥ —Å –æ–±—É–≤–∫–∏</h2>

<div class="search-filter-box">
  <form method="get" action="{{ url_for('catalog.catalog') }}">
    <input type="text" name="q" placeholder="üîç –¢—ä—Ä—Å–∏ –ø–æ –∏–º–µ –∏–ª–∏ —Ü–≤—è—Ç" value="{{ request.args.get('q', '') }}">
    <button type="submit">–¢—ä—Ä—Å–µ–Ω–µ</button>
  </form>

  <form method="get" action="{{ url_for('catalog.catalog') }}">
    <input type="number" step="0.01" name="min_price" placeholder="–ú–∏–Ω. —Ü–µ–Ω–∞" value="{{ request.args.get('min_price', '') }}">
    <input type="number" step="0.01" name="max_price" placeholder="–ú–∞–∫—Å. —Ü–µ–Ω–∞" value="{{ request.args.get('max_price', '') }}">
    <input type="number" name="size" placeholder="–†–∞–∑–º–µ—Ä" value="{{ request.args.get('size', '') }}">
    <label><input type="checkbox" name="in_stock" value="1" {% if request.args.get('in_stock') %}checked{% endif %}> –í –Ω–∞–ª–∏—á–Ω–æ—Å—Ç</label>
    <button type="submit">–§–∏–ª—Ç—Ä–∏—Ä–∞–π</button>
  </form>
</div>

<hr>

{% if products %}
  <div class="product-container">
    {% for p in products %}
      <div class="product-card">
        <h4>{{ p.name }}</h4>
        <p><b>–¶–≤—è—Ç:</b> {{ p.color }}</p>
        <p><b>–¶–µ–Ω–∞:</b> {{ p.price }} –ª–≤.</p>
        <p><b>–û–ø–∏—Å–∞–Ω–∏–µ:</b> {{ p.description }}</p>
        <p><b>–†–∞–∑–º–µ—Ä–∏:</b> {{ p.sizes|join(", ") }}</p>
        <p><b>–ù–∞–ª–∏—á–Ω–æ—Å—Ç:</b> {{ p.stock }}</p>

        <form action="{{ url_for('cart.add_to_cart', product_id=p.id) }}" method="post">
          <label>–ë—Ä–æ–π:</label>
          <input type="number" name="quantity" value="1" min="1" style="width:50px;">
          <button type="submit">–î–æ–±–∞–≤–∏ –≤ –∫–æ—à–Ω–∏—Ü–∞—Ç–∞</button>
        </form>

        {% if is_admin %}
          <div class="admin-links">
            <a href="{{ url_for('catalog.edit_product', product_id=p.id) }}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a> |
            <a href="{{ url_for('catalog.delete_product', product_id=p.id) }}">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</a>
          </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
{% else %}
  <p><b>‚ùå –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –ø–æ –∑–∞–¥–∞–¥–µ–Ω–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏.</b></p>
{% endif %}

{% if is_admin %}
  <hr>
  {% if show_add_form %}
    <h3>‚ûï –î–æ–±–∞–≤–∏ –ø—Ä–æ–¥—É–∫—Ç</h3>
    <form method="POST">
      –ò–º–µ: <input type="text" name="name" required><br><br>
      –û–ø–∏—Å–∞–Ω–∏–µ: <textarea name="description" required></textarea><br><br>
      –¶–≤—è—Ç: <input type="text" name="color" required><br><br>
      –†–∞–∑–º–µ—Ä–∏ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏ —Å—ä—Å –∑–∞–ø–µ—Ç–∞—è): <input type="text" name="sizes" required><br><br>
      –¶–µ–Ω–∞: <input type="number" step="0.01" name="price" required><br><br>
      –ù–∞–ª–∏—á–Ω–æ—Å—Ç: <input type="number" name="stock" required><br><br>
      <button type="submit">–î–æ–±–∞–≤–∏</button>
    </form>
  {% elif edit_product %}
    <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π –ø—Ä–æ–¥—É–∫—Ç</h3>
    <form method="POST">
      –ò–º–µ: <input type="text" name="name" value="{{ edit_product.name }}" required><br><br>
      –û–ø–∏—Å–∞–Ω–∏–µ: <textarea name="description" required>{{ edit_product.description }}</textarea><br><br>
      –¶–≤—è—Ç: <input type="text" name="color" value="{{ edit_product.color }}" required><br><br>
      –†–∞–∑–º–µ—Ä–∏ (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏ —Å—ä—Å –∑–∞–ø–µ—Ç–∞—è): <input type="text" name="sizes" value="{{ edit_product.sizes|join(',') }}" required><br><br>
      –¶–µ–Ω–∞: <input type="number" step="0.01" name="price" value="{{ edit_product.price }}" required><br><br>
      –ù–∞–ª–∏—á–Ω–æ—Å—Ç: <input type="number" name="stock" value="{{ edit_product.stock }}" required><br><br>
      <button type="submit">–ó–∞–ø–∞–∑–∏</button>
    </form>
  {% else %}
    <p><a href="{{ url_for('catalog.add_product') }}">‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤ –ø—Ä–æ–¥—É–∫—Ç</a></p>
  {% endif %}
{% endif %}

{% endblock %}
